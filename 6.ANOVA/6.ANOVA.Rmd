---
title: |
  | 《生物实验设计》
  | 第六章$~$方差分析
author: |
  | 王超
  |
  | 广东药科大学
  |
  | Email: wangchao@gdpu.edu.cn
date: |
  | `r Sys.Date()`
  |    
  | ![](logo.png){width=1.5in} 
fontsize: 10pt
output: beamer_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(dev = 'pdf')
library(ggplot2)
library(showtext)
showtext::showtext_auto()
```

## 

\LARGE 第六章$~$方差分析

## 方差分析

-   样本平均数的假设检验适用于样本与总体或者两个样本之间的差异显著性检验

-   实际研究中，常需要3个及3个以上样本平均数进行比较

    -   如果两两相互比较，随着样本平均数个数增加而剧增
    -   $n$个样本平均数需要比较的次数为$C_n^2$

-   导致：

    -   检验过程繁琐
    -   无统一的试验误差，误差估计的精确性和检验的灵敏性低
    -   推断的可靠性降低

## 方差分析

-   方差分析ANOVA

    -   将所有处理的观测值作为一个整体，一次比较就对所有各组间样本平均数是否有差异做出判断

    -   差异不显著，则认为他们是相同的

    -   差异显著，进一步比较是哪一组数据与其他数据不同

-   方差分析的用途

    -   \textcolor{red}{多个样本平均数的比较}

    -   分析多个因素间的交互作用

    -   回归方程的假设检验

    -   方差的同质性检验

## 第一节$~$方差分析的基本方法 $~$`一、方差分析的基本原理`

-   处理效应

    -   处理因素的不同造成

-   误差效应

    -   试验过程中偶然性因素的干扰

    -   测量误差

-   方差分析的基本思想

    -   将测量数据的总变异按照变异原因不同分解为处理效应和误差效应，并作出其数量估计

## 第一节$~$方差分析的基本方法 $~$`一、方差分析的基本原理`

-   反应测量数据变异性指标

    -   方差，即均方

    $$
    s^2 = \frac{\sum(x - \bar{x})^2}{n - 1}
    $$

-   分别计算出处理效应的方差和误差效应的方差，在一定显著水平下进行比较

    -   二者相差不大，说明试验处理对指标影响不大

    -   二者相差较大，说明试验处理影响是很大的，不可忽视

## 第一节$~$方差分析的基本方法 $~$`二、数学模型`

以单因素试验为例，假设试验考察的因素有$k$个水平，每个处理重复$n$次，共有$nk$个观测值

$$
\begin{bmatrix}
A_1 & A_2 & \ldots & A_i & \ldots & A_k \\
x_{1,1} & x_{2,1} & \ldots & x_{i,1} & \ldots & x_{k,1}\\
x_{1,2} & x_{2,2} & \ldots & x_{i,2} & \ldots & x_{k,2}\\
\vdots & \vdots &   & \vdots &   & \vdots\\
x_{1,j} & x_{2,j} & \ldots & x_{i,j} & \ldots & x_{k,j}\\
\vdots & \vdots &   & \vdots &   & \vdots\\
x_{1,n} & x_{2,n} & \ldots & x_{i,n} & \ldots & x_{k,n}\\
\end{bmatrix}
$$ 处理的总和$T_{i,:}$， $$
\begin{bmatrix}
T_{1,:} & T_{2,:} & \ldots & T_{i,:} & \ldots & T_{k,:} \\
\end{bmatrix}
$$

平均$\bar{x}_{i,:}$， $$
\begin{bmatrix}
\bar{x}_{1,:} & \bar{x}_{2,:} & \ldots & \bar{x}_{i,:} & \ldots & \bar{x}_{k,:} \\
\end{bmatrix}
$$

## 第一节$~$方差分析的基本方法 $~$`二、数学模型`

$$
x_{i,j} = \mu_i + \epsilon_{i, j}
$$

-   $x_{i,j}$表示第$i$个处理的第$j$个观测值，对于任意$x_{i,j}$，可以用线性可加模型来进行描述

-   $\mu_i$为第$i$个处理观测值总体平均数

-   $\epsilon_{i, j}$为试验误差，相互独立，服从正态分布 $N(0, \sigma^2)$

## 第一节$~$方差分析的基本方法 $~$`二、数学模型`

单因素试验资料的数学模型

$$
\mu = \frac{1}{k}\sum_{i = 1}^{k} \mu_i
$$ $$
\tau_i =  \mu_i - \mu
$$ $$
x_{i,j} = \mu + \tau_i + \epsilon_{i, j}
$$

-   $\mu$为总体平均数
-   $\tau_i$为第$i$个处理的效应
-   将观测值分解为影响观测值大小的各个因素的线性组合

## 第一节$~$方差分析的基本方法 $~$`二、数学模型`

对$\tau_i$的不同假定

-   固定模型

    -   各个处理的效应$\tau_i$是固定的一个常量，由固定因素引起的效应 $\sum \tau_i = 0$

    -   除去随机误差之后每个处理所产生的效应是固定的，分析的目的在于研究$\tau_i$

-   随机模型

    -   各个处理的效应$\tau_i$是由随机因素所引起的效应

    -   $\tau_i$是一个随机变量，是从$N(0, \sigma^2)$的正态总体中得到的

    -   研究的目的不仅是$\tau_i$，还有$\tau_i$的变异程度

-   混合模型

    -   多因素试验中，既包括固定效应的试验因素，又包括随机效应的试验因素

## 第一节$~$方差分析的基本方法 $~$`三、平方和与自由度的分解`

-   全部观测值的变异可以用总体的方差来度量

-   方差是离均差的平方和（$SS$）除以自由度 $s^2=\frac{\sum{(x-\bar{x})^2}}{\text{d}f}$

-   依据变异来源将试验资料的总变异分解为相应的变异

-   包括总平方和（$SS_T$）与总自由度（$df_T$）的各个变异来源

## 第一节$~$方差分析的基本方法 $~$`三、平方和与自由度的分解`

（一）平方和分解

-   引起观测值变异的原因有处理效应和误差效应

    -   处理间平均数的差异由处理效应所致

    -   同一处理内的变异由随机误差引起

-   任一观测值$x_ij$与总平均数之差可以表示为：

$$
(x_{i,j} - x_{:,:}) = (x_{i,j} - \bar{x}_{i,:}) + (\bar{x}_{i,:} - x_{:,:})
$$

## 第一节$~$方差分析的基本方法 $~$`三、平方和与自由度的分解`

（一）平方和分解

- 两边分别平方
$$
(x_{i,j} - x_{:,:})^2 = (x_{i,j} - \bar{x}_{i,:})^2 + 2(x_{i,j} - \bar{x}_{i,:})(\bar{x}_{i,:} - x_{:,:}) + (\bar{x}_{i,:} - x_{:,:})^2
$$

- 每一个处理n个观测值离均差平方和累加，有
$$
\sum_{j=1}^{n}(x_{i,j} - x_{:,:})^2 = \sum_{j=1}^{n}(x_{i,j} - \bar{x}_{i,:})^2 + 2\sum_{j=1}^{n}(x_{i,j}-\bar{x}_{i,:})(\bar{x}_{i,:} - x_{:,:}) + \sum_{j=1}^{n}(\bar{x}_{i,:} - x_{:,:})^2
$$

## 第一节$~$方差分析的基本方法 $~$`三、平方和与自由度的分解`

（一）平方和分解

- 因为 $\sum_{j=1}^{n}(x_{i,j}-\bar{x}_{i,:})(\bar{x}_{i,:} - x_{:,:}) = (\bar{x}_{i,:} - x_{:,:})\sum_{j=1}^{n}(x_{i,j} - \bar{x}_{i,:})=0$

$$
  \sum_{j=1}^{n}(x_{i,j} - x_{:,:})^2 = \sum_{j=1}^{n}(x_{i,j} - \bar{x}_{i,:})^2 + n(\bar{x}_{i,:} - x_{:,:})^2
$$

- 把$k$个处理的离均差平方再累加，得

$$
  \sum_{i=1}^{n}\sum_{j=1}^{n}(x_{i,j} - x_{:,:})^2 = \sum_{i=1}^{n}\sum_{j=1}^{n}(x_{i,j} - \bar{x}_{i,:})^2 + n\sum_{i=1}^{n}(\bar{x}_{i,:} - x_{:,:})^2
$$

## 第一节$~$方差分析的基本方法 $~$`三、平方和与自由度的分解`

（一）平方和分解

总平方和 = 处理间平方和+处理内平方和

 $SS_T= SS_t + SS_e$
 
$$
\begin{cases}
     \sum_{i=1}^{n}\sum_{j=1}^{n}(x_{i,j} - \bar{x}_{i,:})^2\\
      n\sum_{i=1}^{n}(\bar{x}_{i,:} - x_{:,:})^2
\end{cases}
 $$
 
 $SS_T= SS_t + SS_e$
 
## 第一节$~$方差分析的基本方法 $~$`三、平方和与自由度的分解`

（二）自由度分解

总自由度= 处理间自由度+处理内自由度

$df_T= df_t + df_e$

$$
\begin{cases}
    df_T = nk - 1\\
    df_t = k - 1\\
    df_e = (nk - 1)- (k - 1) = k(n-1)
\end{cases}
 $$

## 第一节$~$方差分析的基本方法 $~$`三、平方和与自由度的分解`

（三）计算方差

根据各变异部分得平方和与自由度，计算处理间$s_t^2$和处理内方差$s_e^2$
$$
\begin{cases}
    s_t^2 = \frac{SS_t}{df_t}\\
    s_e^2 = \frac{SS_e}{df_e}
\end{cases}
$$

## 第一节$~$方差分析的基本方法 $~$`四、统计假设的显著性检验--`$F$`检验`

- 在方差分析中进行$F$检验的目的在于推断处理间的差异是否存在
- 计算$F$时，以处理间均方$s_t^2$作分子，以处理内均方$s_e^2$作分母
- 无效假设是把各个处理的变量假设来自同一个总体，认为处理间方差与处理内方差相等
$$
\begin{cases}
    H_0: \sigma^2_t = \sigma^2_e\\
    H_A: \sigma^2_t \neq \sigma^2_e
\end{cases}
$$
- 无效假设是否成立，主要取决于计算出来的$F$值在$F$分布中出现的概率


## 第一节$~$方差分析的基本方法 $~$`五、多重比较`


